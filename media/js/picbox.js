/*!
	Picbox v2.1
	(c) 2010 Ben Kay <http://bunnyfire.co.uk>

	Based on code from Slimbox v1.7 - The ultimate lightweight Lightbox clone
	(c) 2007-2009 Christophe Beyls <http://www.digitalia.be>
	
	Uses jQuery-mousewheel Version: 3.0.2
	(c) 2009 Brandon Aaron <http://brandonaaron.net>
	
	MIT-style license.
*/

(function(b){function $(){var a={x:j.scrollLeft(),y:j.scrollTop()};p=j.width()/2;q=j.height()/2;if(L){p+=a.x;q+=a.y;b(k).css({left:a.x,top:a.y,width:j.width(),height:j.height()})}b(h).css({top:q,left:p,width:"1px",height:"1px"})}function M(a){e.hideFlash&&b.each(["object","embed"],function(d,f){b(f).each(function(){if(a)this._picbox=this.style.visibility;this.style.visibility=a?"hidden":this._picbox})});k.style.display="";var c=a?"bind":"unbind";b(document)[c]("keydown",aa);b(document)[c]("mousewheel", ba);b(document)[c]("mousemove",D)}function aa(a){a=a.keyCode;return b.inArray(a,e.closeKeys)>=0?N():b.inArray(a,e.nextKeys)>=0?O():b.inArray(a,e.previousKeys)>=0?P():false}function D(){clearTimeout(E);b(s).fadeIn();E=setTimeout(function(){b(s).fadeOut()},e.controlsFadeDelay)}function Q(a){a=1==a?"unbind":"bind";b(document)[a]("mousemove",D);clearTimeout(E)}function P(){return F(w,true)}function O(){return F(x,true)}function F(a,c){if(a>=0){r=a;B=l[a][0];w=(r||(e.loop?l.length:0))-1;x=(r+1)%l.length|| (e.loop?0:-1);R();k.className="pbLoading";b(h).css("display","none");b(S).html(l[r][1]||"");b(T).html((l.length>1&&e.counterText||"").replace(/{x}/,r+1).replace(/{y}/,l.length));if(w>=0){U.src=l[w][0];b(G).removeClass(y)}if(x>=0){V.src=l[x][0];b(H).removeClass(y)}i=new Image;i.onload=function(){ca(c)};i.src=B}return false}function ca(a){W();var c=j.width()-e.margins,d=j.height()-e.margins,f=1;if(i.width>c||i.height>d){f=Math.min(c/i.width,d/i.height);b(zoomBtn).removeClass(y);I=false}else{b(zoomBtn).addClass(y); I=true}t=J=f;z(f,a);b(h).attr("src",B);b(h).css("display","");k.className=""}function z(a,c){var d=a/t;u=p-(p-u)*d;v=q-(q-v)*d;t=a;d=i.width*a;var f=i.height*a,g=u-d/2>>0,o=v-f/2>>0;c=c?0:e.resizeDuration;a=0==a?function(){b(h).hide()}:function(){};b(h).animate({width:d,height:f,top:o,left:g},{queue:false,duration:c,easing:e.resizeEasing,complete:a});return false}function W(){u=p;v=q}function ba(a,c){b(zoomBtn).addClass(A);return z(t+c*t/10)}function X(){if(t==J&&u==p&&v==q&&!I){b(zoomBtn).addClass(A); return z(1)}else{b(zoomBtn).removeClass(A);W();return z(J)}}function R(){i.onload=function(){};i.src=U.src=V.src=B;b(h).stop();b([G,H]).addClass(y);b(zoomBtn).removeClass(A)}function N(){if(r>=0){R();r=w=x=-1;z(0);M();b(s).stop().hide();b(k).stop().fadeOut()}return false}function K(a){var c=[].slice.call(arguments,1),d=0;a=b.event.fix(a||window.event);a.type="mousewheel";if(a.wheelDelta)d=a.wheelDelta/120;if(a.detail)d=-a.detail/3;c.unshift(a,d);return b.event.handle.apply(this,c)}var j=b(window), e,l,r=-1,B,w,x,da=window.XMLHttpRequest==undefined&&ActiveXObject!=undefined,L,p,q,u,v,t,J,E,I,i={},U=new Image,V=new Image,k,Y,h,G,H,s,S,T,A="pbzoomed",y="pbgreyed";b(document).ready(function(){b(document.body).append(b([k=b('<div id="pbOverlay" />').click(N).append(Y=b('<div id="pbCloseBtn" />')[0])[0],h=b('<img id="pbImage" />').dblclick(X)[0],s=b('<div id="pbBottom" />').append([S=b('<div id="pbCaption" />')[0],b('<div id="pbNav" />').append([G=b('<a id="pbPrevBtn" href="#" />').click(P)[0],zoomBtn= b('<a id="pbZoomBtn" href="#" />').click(X)[0],H=b('<a id="pbNextBtn" href="#" />').click(O)[0]])[0],T=b('<div id="pbNumber" />')[0]]).mouseover(function(){Q(1)}).mouseout(Q)[0]]).css("display","none"));(L=da||k.currentStyle&&k.currentStyle.position!="fixed")&&b([k,Y,h,s]).css("position","absolute");b(h).tinyDrag(function(){var a=b(h),c=a.position();u=c.left-j.scrollLeft()+a.width()/2;v=c.top-j.scrollTop()+a.height()/2;b(zoomBtn).addClass(A)})});b.picbox=function(a,c,d){e=b.extend({loop:false,overlayOpacity:0.8, overlayFadeDuration:200,resizeDuration:300,resizeEasing:"swing",controlsFadeDelay:2E3,counterText:false,hideFlash:true,closeKeys:[27,88,67],previousKeys:[37,80],nextKeys:[39,78],margins:0},d||{});if(typeof a=="string"){a=[[a,c]];c=0}b(k).css("opacity",0).fadeTo(e.overlayFadeDuration,e.overlayOpacity);b(s).css("display","");D();$();M(1);l=a;e.loop=e.loop&&l.length>1;return F(c)};b.fn.picbox=function(a,c,d){c=c||function(g){return[g.href,g.title]};d=d||function(){return true};var f=this;b(f).unbind("click").click(function(){var g= this,o=[];filteredLinks=b.grep(f,function(m){return d.call(g,m)});for(var n=0;n<filteredLinks.length;n++)o[n]=c(filteredLinks[n]);return b.picbox(o,b.inArray(this,filteredLinks),a)});return f};b.fn.tinyDrag=function(a){return b.tinyDrag(this,a)};b.tinyDrag=function(a,c){function d(m){var Z=m.pageX;m=m.pageY;if(n)a.css({left:o.x+(Z-g.x),top:o.y+(m-g.y)});else if(Math.abs(Z-g.x)>1||Math.abs(m-g.y)>1)n=true;return false}function f(){b(document).unbind("mousemove",d).unbind("mouseup");n&&c&&c()}var g, o,n;a.mousedown(function(m){a.offset();n=false;g={x:m.pageX,y:m.pageY};o={x:parseInt(a.css("left")),y:parseInt(a.css("top"))};b(document).mousemove(d).mouseup(f);return false});return a};var C=["DOMMouseScroll","mousewheel"];b.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var a=C.length;a;)this.addEventListener(C[--a],K,false);else this.onmousewheel=K},teardown:function(){if(this.removeEventListener)for(var a=C.length;a;)this.removeEventListener(C[--a],K,false);else this.onmousewheel= null}};b.fn.extend({mousewheel:function(a){return a?this.bind("mousewheel",a):this.trigger("mousewheel")},unmousewheel:function(a){return this.unbind("mousewheel",a)}})})(jQuery);

if (!/android|iphone|ipod|series60|symbian|windows ce|blackberry/i.test(navigator.userAgent)) {
	jQuery(function($) {
		$("a[rel^='lightbox']").picbox({/* Put custom options here */}, null, function(el) {
			return (this == el) || ((this.rel.length > 8) && (this.rel == el.rel));
		});
	});
}